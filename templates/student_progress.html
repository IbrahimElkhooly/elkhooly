<!DOCTYPE html>
<html lang="ar">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ØªÙ‚Ø±ÙŠØ± ØªÙ‚Ø¯Ù…ÙŠ</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body { font-family: Arial, sans-serif; direction: rtl; background-color: #f4f4f4; }
        .container { margin-top: 30px; }
        h2 { text-align: center; margin-bottom: 20px; }
        .high-score { background-color: #d4edda !important; }
        .medium-score { background-color: #fff3cd !important; }
        .low-score { background-color: #f8d7da !important; }
    </style>
</head>
<body>

<div class="container">
    <h2>ğŸ“Š ØªÙ‚Ø±ÙŠØ± ØªÙ‚Ø¯Ù… Ø§Ù„Ø·Ø§Ù„Ø¨</h2>

    {% if progress_data %}
    <table class="table table-bordered table-striped">
        <thead class="table-dark">
            <tr>
                <th>Ø§Ù„Ù…Ø§Ø¯Ø©</th>
                <th> Ø±Ù‚Ù… Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø©</th>
                <th>Ø§Ù„Ù…Ø¹Ø¯Ù„ Ø§Ù„Ø¹Ø§Ù… (%)</th>
                <th>Ø¹Ø¯Ø¯ Ø§Ù„ÙˆØ§Ø¬Ø¨Ø§Øª</th>
                <th>Ø¢Ø®Ø± Ù†Ø´Ø§Ø·</th>
            </tr>
        </thead>
        <tbody>
        {% for row in progress_data %}
            <tr class="{% if row.average_score >= 80 %}high-score{% elif row.average_score >= 50 %}medium-score{% else %}low-score{% endif %}">
                <td>{{ row.subject_name }}</td>
                <td>{{ row.exams_completed }}</td>
                <td>{{ row.average_score|round(2) }}%</td>
                <td>{{ row.assignments_completed }}</td>
                <td>{{ row.last_activity.strftime('%Y-%m-%d %H:%M') }}</td>
            </tr>
        {% endfor %}
        </tbody>
    </table>

    <canvas id="progressChart"></canvas>

    <div class="alert alert-info mt-3" id="comparison_result">ğŸ“Š ÙŠØªÙ… Ø­Ø³Ø§Ø¨ Ø£Ø¯Ø§Ø¦Ùƒ Ù…Ù‚Ø§Ø±Ù†Ø© Ø¨Ø²Ù…Ù„Ø§Ø¦Ùƒ...</div>

    <button onclick="downloadPDF()" class="btn btn-primary mt-3">ğŸ“¥ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØªÙ‚Ø±ÙŠØ±</button>

   <script>
document.addEventListener("DOMContentLoaded", function () {
    fetch("{{ url_for('student_comparison') }}")
        .then(response => {
            if (!response.ok) {
                throw new Error("HTTP error! Status: " + response.status);
            }
            return response.json();
        })
        .then(data => {
            console.log("ğŸ“Š Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù‚Ø§Ø±Ù†Ø© Ø§Ù„Ø£Ø¯Ø§Ø¡:", data);  // âœ… Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙÙŠ Console Ù„Ù„ØªØ­Ù‚Ù‚

            let message = "";
            if (data.student_avg > data.class_avg) {
                message = `ğŸ‰ Ø£Ø¯Ø§Ø¤Ùƒ (${data.student_avg.toFixed(2)}%) Ø£ÙØ¶Ù„ Ù…Ù† Ù…ØªÙˆØ³Ø· Ø§Ù„ÙØµÙ„ (${data.class_avg.toFixed(2)}%)!`;
            } else if (data.student_avg == data.class_avg) {
                message = `âš–ï¸ Ø£Ø¯Ø§Ø¤Ùƒ (${data.student_avg.toFixed(2)}%) Ù…ØªØ³Ø§ÙˆÙ Ù…Ø¹ Ù…ØªÙˆØ³Ø· Ø§Ù„ÙØµÙ„ (${data.class_avg.toFixed(2)}%)`;
            } else {
                message = `âš ï¸ ØªØ­ØªØ§Ø¬ Ø¥Ù„Ù‰ ØªØ­Ø³ÙŠÙ†! Ø£Ø¯Ø§Ø¤Ùƒ (${data.student_avg.toFixed(2)}%) Ø£Ù‚Ù„ Ù…Ù† Ù…ØªÙˆØ³Ø· Ø§Ù„ÙØµÙ„ (${data.class_avg.toFixed(2)}%)`;
            }

            document.getElementById("comparison_result").innerText = message;
        })
        .catch(error => {
            document.getElementById("comparison_result").innerText = "âŒ Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª!";
            console.error("âŒ Ø®Ø·Ø£ ÙÙŠ Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª:", error);
        });
});
</script>

    {% else %}
        <p class="text-center">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª ØªÙ‚Ø¯Ù… Ù…ØªØ§Ø­Ø© Ø­Ø§Ù„ÙŠÙ‹Ø§.</p>
    {% endif %}
</div>

</body>
</html>
