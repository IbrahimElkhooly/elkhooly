{% extends 'base.html' %}

{% block content %}
<div class="container mt-4">
    <div class="card shadow-lg p-4">
        <h2 class="text-center text-primary">
            <i class="fas fa-book"></i> {{ subject.name }}
        </h2>
{% if subject.evaluation_status %}
    <a href="{{ url_for('evaluate_subject', subject_id=subject.id) }}" class="btn btn-primary">
        ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ù…Ø§Ø¯Ø©
    </a>
{% else %}
    <button class="btn btn-secondary" disabled>Ø§Ù„ØªÙ‚ÙŠÙŠÙ… ØºÙŠØ± Ù…ØªØ§Ø­</button>
{% endif %}
<style>
    :root {
        --primary-color: #1877f2;
        --hover-bg: #e7f3ff;
    }

    .dashboard-container {
        direction: rtl;
        background: #f0f2f5;
        min-height: 100vh;
        padding: 20px;
    }

    .dashboard-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 15px;
    }

    .dashboard-card {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        padding: 20px;
        background: white;
        border-radius: 15px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        text-align: center;
        text-decoration: none;
        color: #333;
        font-weight: 500;
        transition: transform 0.3s, background-color 0.3s;
        position: relative;
        overflow: hidden;
    }

    .dashboard-card:hover {
        transform: translateY(-5px);
    }

    .dashboard-card i {
        font-size: 40px;
        margin-bottom: 10px;
    }

    .dashboard-card.subjects { background-color: #ffeb3b; }
    .dashboard-card.add-subject { background-color: #4caf50; color: white; }
    .dashboard-card.admin-panel { background-color: #f44336; color: white; }
    .dashboard-card.grades { background-color: #ff9800; color: white; }
    .dashboard-card.teacher-grades { background-color: #9c27b0; color: white; }
    .dashboard-card.bank { background-color: #808080; color: white; }
    .dashboard-card.analytics { background-color: #00bcd4; color: white; } /* Ù„ÙˆÙ† Ù…Ù…ÙŠØ² Ù„Ù„ÙƒØ§Ø±Øª Ø§Ù„Ø¬Ø¯ÙŠØ¯ */

    .dashboard-card:hover {
        background-color: rgba(0, 0, 0, 0.1);
    }

    @media (max-width: 768px) {
        .dashboard-grid {
            grid-template-columns: repeat(2, 1fr);
        }
    }

    @media (max-width: 480px) {
        .dashboard-grid {
            grid-template-columns: repeat(1, 1fr);
        }
    }
    .messageBox {
  width: fit-content;
  height: 40px;
  display: flex;
  align-items: center;
  justify-content: center;
  background-color: #2d2d2d;
  padding: 0 15px;
  border-radius: 10px;
  border: 1px solid rgb(63, 63, 63);
}
.messageBox:focus-within {
  border: 1px solid rgb(110, 110, 110);
}
.fileUploadWrapper {
  width: fit-content;
  height: 100%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-family: Arial, Helvetica, sans-serif;
}

#file {
  display: none;
}
.fileUploadWrapper label {
  cursor: pointer;
  width: fit-content;
  height: fit-content;
  display: flex;
  align-items: center;
  justify-content: center;
  position: relative;
}
.fileUploadWrapper label svg {
  height: 18px;
}
.fileUploadWrapper label svg path {
  transition: all 0.3s;
}
.fileUploadWrapper label svg circle {
  transition: all 0.3s;
}
.fileUploadWrapper label:hover svg path {
  stroke: #fff;
}
.fileUploadWrapper label:hover svg circle {
  stroke: #fff;
  fill: #3c3c3c;
}
.fileUploadWrapper label:hover .tooltip {
  display: block;
  opacity: 1;
}
.tooltip {
  position: absolute;
  top: -40px;
  display: none;
  opacity: 0;
  color: white;
  font-size: 10px;
  text-wrap: nowrap;
  background-color: #000;
  padding: 6px 10px;
  border: 1px solid #3c3c3c;
  border-radius: 5px;
  box-shadow: 0px 5px 10px rgba(0, 0, 0, 0.596);
  transition: all 0.3s;
}
#messageInput {
  width: 200px;
  height: 100%;
  background-color: transparent;
  outline: none;
  border: none;
  padding-left: 10px;
  color: white;
}
#messageInput:focus ~ #sendButton svg path,
#messageInput:valid ~ #sendButton svg path {
  fill: #3c3c3c;
  stroke: white;
}

#sendButton {
  width: fit-content;
  height: 100%;
  background-color: transparent;
  outline: none;
  border: none;
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  transition: all 0.3s;
}
#sendButton svg {
  height: 18px;
  transition: all 0.3s;
}
#sendButton svg path {
  transition: all 0.3s;
}
#sendButton:hover svg path {
  fill: #3c3c3c;
  stroke: white;
}
</style>

        <p><strong><i class="fas fa-chalkboard-teacher"></i> Ø§Ù„Ù…Ø¹Ù„Ù…:</strong> {{ subject.teacher }}</p>
        <p><strong><i class="fas fa-info-circle"></i> ÙˆØµÙ Ø§Ù„Ù…Ø§Ø¯Ø©:</strong> {{ subject.description }}</p>
    </div>

  <!-- Ø¯Ø§Ø®Ù„ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„ØªØ¨ÙˆÙŠØ¨Ø§Øª Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© -->
<ul class="nav nav-tabs mt-4" id="subjectTabs" role="tablist">
    <!-- Ø§Ù„ØªØ¨ÙˆÙŠØ¨Ø§Øª Ø§Ù„Ø­Ø§Ù„ÙŠØ© -->
    <li class="nav-item">
        <a class="nav-link " id="files-tab" data-bs-toggle="tab" href="#files" role="tab">ğŸ“‚ Ø§Ù„Ù…Ù„ÙØ§Øª</a>
    </li>
    <li class="nav-item">
        <a class="nav-link" id="exams-tab" data-bs-toggle="tab" href="#exams" role="tab">ğŸ“‘ Ø§Ù„Ø§Ù…ØªØ­Ø§Ù†Ø§Øª</a>
    </li>
    <li class="nav-item">
        <a class="nav-link" id="homeworks-tab" data-bs-toggle="tab" href="#homeworks" role="tab">ğŸ“ Ø§Ù„ÙˆØ§Ø¬Ø¨Ø§Øª</a>
    </li>

    <!-- Ø§Ù„ØªØ¨ÙˆÙŠØ¨ Ø§Ù„Ø¬Ø¯ÙŠØ¯ -->
    <li class="nav-item">
        <a class="nav-link" id="lessons-tab" data-bs-toggle="tab" href="#lessons" role="tab">ğŸ“š Ø§Ù„Ø¯Ø±ÙˆØ³</a>
    </li>

    <li class="nav-item">
        <a class="nav-link" id="communication-tab" data-bs-toggle="tab" href="#communication" role="tab">ğŸ’¬ ØªÙˆØ§ØµÙ„</a>
    </li>
    {% if session.get('role') in ['assistant', 'teacher'] %}
    <li class="nav-item">
        <a class="nav-link" id="manage-tab" data-bs-toggle="tab" href="#manage" role="tab">âš™ï¸ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø§Ø¯Ø©</a>
    </li>
    {% endif %}
</ul>
    <div class="tab-content p-3 border border-top-0">

        <!-- ØªØ¨ÙˆÙŠØ¨ Ø§Ù„ØªÙˆØ§ØµÙ„ -->
<div class="tab-pane fade" id="communication" role="tabpanel">
    <ul class="nav nav-pills mb-3">
        <li class="nav-item">
            <a class="nav-link active" id="summary-tab" data-bs-toggle="tab" href="#summary" role="tab">ğŸ“¢ Ù…ÙˆØ¬Ø²</a>
        </li>
        <li class="nav-item">
            <a class="nav-link" id="qa-tab" data-bs-toggle="tab" href="#qa" role="tab">â“ Ø³Ø¤Ø§Ù„ ÙˆØ¬ÙˆØ§Ø¨</a>
        </li>
        <li class="nav-item">
            <a class="nav-link" id="chat-tab" data-bs-toggle="tab" href="#chat" role="tab">ğŸ’¬ Ø´Ø§Øª Ø¬Ù…Ø§Ø¹ÙŠ</a>
        </li>
    </ul>

    <!-- Ù…Ø­ØªÙˆÙ‰ Ø§Ù„ØªØ¨ÙˆÙŠØ¨Ø§Øª -->
    <div class="tab-content">
        <!-- ØªØ¨ÙˆÙŠØ¨ Ø§Ù„Ù…ÙˆØ¬Ø² -->
        <div class="tab-pane fade show active" id="summary" role="tabpanel">
            <h4>ğŸ“¢ Ù…ÙˆØ¬Ø² Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†Ø§Øª</h4>

            {% if session.get('role') == 'teacher' %}
            <form action="{{ url_for('add_announcement', subject_id=subject.id) }}" method="POST">
                <textarea class="form-control" name="content" placeholder="Ø§ÙƒØªØ¨ Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†..." required></textarea>
                <button type="submit" class="btn btn-success mt-2">Ø¥Ø±Ø³Ø§Ù„</button>
            </form>
            {% endif %}

            <h4 class="mt-4">ğŸ“¢ Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†Ø§Øª Ø§Ù„Ø³Ø§Ø¨Ù‚Ø©</h4>
            {% if announcements %}
            <ul class="list-group">
                {% for ann in announcements %}
                <li class="list-group-item">
                    <strong>{{ ann.teacher_name }}:</strong> {{ ann.content }}
                    <small class="text-muted d-block">
                        {{ ann.created_at.strftime('%Y-%m-%d %H:%M') if ann.created_at else 'ØªØ§Ø±ÙŠØ® ØºÙŠØ± Ù…ØªÙˆÙØ±' }}
                    </small>
                </li>
                {% endfor %}
            </ul>
            {% else %}
            <div class="alert alert-info mt-2">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¥Ø¹Ù„Ø§Ù†Ø§Øª Ø­ØªÙ‰ Ø§Ù„Ø¢Ù†.</div>
            {% endif %}
        </div>

        <!-- ØªØ¨ÙˆÙŠØ¨ Ø§Ù„Ø£Ø³Ø¦Ù„Ø© ÙˆØ§Ù„Ø£Ø¬ÙˆØ¨Ø© -->
        <div class="tab-pane fade" id="qa" role="tabpanel">
            <h4>â“ Ø§Ù„Ø£Ø³Ø¦Ù„Ø© ÙˆØ§Ù„Ø£Ø¬ÙˆØ¨Ø©</h4>
           <div class="messageBox">
    <div class="fileUploadWrapper">
        <label for="file">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 337 337">
                <circle stroke-width="20" stroke="#6c6c6c" fill="none" r="158.5" cy="168.5" cx="168.5"></circle>
                <path stroke-linecap="round" stroke-width="25" stroke="#6c6c6c" d="M167.759 79V259"></path>
                <path stroke-linecap="round" stroke-width="25" stroke="#6c6c6c" d="M79 167.138H259"></path>
            </svg>
            <span class="tooltip">Ø¥Ø¶Ø§ÙØ© ØµÙˆØ±Ø©</span>
        </label>
        <input type="file" id="file" name="file" />
    </div>
    <form action="{{ url_for('ask_question', subject_id=subject.id) }}" method="POST" style="display: flex; width: 100%;">
        <input required name="question" id="messageInput" placeholder="Ø§ÙƒØªØ¨ Ø³Ø¤Ø§Ù„Ùƒ..." type="text">
        <button type="submit" id="sendButton">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 664 663">
                <path fill="none" d="M646.293 331.888L17.7538 17.6187L155.245 331.888M646.293 331.888L17.753 646.157L155.245 331.888M646.293 331.888L318.735 330.228L155.245 331.888"></path>
                <path stroke-linejoin="round" stroke-linecap="round" stroke-width="33.67" stroke="#6c6c6c" d="M646.293 331.888L17.7538 17.6187L155.245 331.888M646.293 331.888L17.753 646.157L155.245 331.888M646.293 331.888L318.735 330.228L155.245 331.888"></path>
            </svg>
        </button>
    </form>
</div>

            <h4 class="mt-4">ğŸ“© Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ø§Ù„Ù…Ø±Ø³Ù„Ø© Ù…Ù† Ø§Ù„Ø·Ù„Ø§Ø¨</h4>
            {% if questions %}
            <ul class="list-group">
                {% for q in questions %}
                    {% if session.get('role') == 'teacher' or session.get('id') == q.student_id or q.is_visible %}
                    <li class="list-group-item">
                        <strong>{{ q.username }}:</strong> {{ q.question }}
                        {% if q.answer %}
                        <p><strong>ğŸ‘¨â€ğŸ« Ø±Ø¯ Ø§Ù„Ù…Ø¹Ù„Ù…:</strong> {{ q.answer }}</p>
                        {% endif %}
                        {% if session.get('role') == 'teacher' %}
                        <form action="{{ url_for('answer_question', question_id=q.id) }}" method="POST" class="mt-2">
                            <input type="text" class="form-control" name="answer" placeholder="Ø§ÙƒØªØ¨ Ø§Ù„Ø±Ø¯..." required>
                            <button type="submit" class="btn btn-primary mt-1">ğŸ’¬ Ø§Ù„Ø±Ø¯</button>
                        </form>
                        <form action="{{ url_for('toggle_question_visibility', question_id=q.id) }}" method="POST" class="mt-2">
                            <button type="submit" class="btn btn-warning">
                                {% if q.is_visible %}ğŸ‘ï¸ Ø¥Ø®ÙØ§Ø¡ Ø¹Ù† Ø§Ù„Ø¬Ù…ÙŠØ¹{% else %}ğŸ‘ï¸â€ğŸ—¨ï¸ Ø¥Ø¸Ù‡Ø§Ø± Ù„Ù„Ø¬Ù…ÙŠØ¹{% endif %}
                            </button>
                        </form>
                        {% endif %}
                    </li>
                    {% endif %}
                {% endfor %}
            </ul>
            {% else %}
            <div class="alert alert-info mt-2">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø£Ø³Ø¦Ù„Ø© Ø­ØªÙ‰ Ø§Ù„Ø¢Ù†.</div>
            {% endif %}
        </div>

        <!-- ØªØ¨ÙˆÙŠØ¨ Ø§Ù„Ø´Ø§Øª Ø§Ù„Ø¬Ù…Ø§Ø¹ÙŠ -->
        <div class="tab-pane fade" id="chat" role="tabpanel">
            <h4>ğŸ’¬ Ø§Ù„Ø´Ø§Øª Ø§Ù„Ø¬Ù…Ø§Ø¹ÙŠ</h4>
            <div id="chat-messages" class="border p-3 bg-light" style="height: 300px; overflow-y: auto;">
                <div class="alert alert-info">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø±Ø³Ø§Ø¦Ù„ Ø¨Ø¹Ø¯.</div>
            </div>
            <form id="chat-form">
                <textarea class="form-control mt-2" name="message" placeholder="Ø§ÙƒØªØ¨ Ø±Ø³Ø§Ù„ØªÙƒ..." required></textarea>
                <button type="submit" class="btn btn-success mt-2">Ø¥Ø±Ø³Ø§Ù„</button>
            </form>
        </div>
    </div>
</div>


        <!-- Ù…Ø­ØªÙˆÙ‰ ØªØ¨ÙˆÙŠØ¨ Ø§Ù„Ø¯Ø±ÙˆØ³ -->
<div class="tab-pane fade" id="lessons" role="tabpanel">
    <div class="card shadow p-3">
        <div class="d-flex justify-content-between align-items-center mb-4">
            <h4 class="mb-0"><i class="fas fa-book-open me-2"></i>Ø§Ù„Ø¯Ø±ÙˆØ³ Ø§Ù„ØªØ¹Ù„ÙŠÙ…ÙŠØ©</h4>
            {% if session.get('role') == 'teacher' %}
            <a href="{{ url_for('add_lesson', subject_id=subject.id) }}" class="btn btn-primary">
                <i class="fas fa-plus-circle me-2"></i>Ø¥Ø¶Ø§ÙØ© Ø¯Ø±Ø³
            </a>
            {% endif %}
        </div>

        {% if lessons %}
        <div class="list-group">
            {% for lesson in lessons %}
            <div class="list-group-item mb-3 rounded shadow-sm">
                <div class="d-flex justify-content-between align-items-start">
                    <div class="w-75">
                        <h5 class="text-primary">{{ lesson.title }}</h5>
                        <p class="text-muted">{{ lesson.content|truncate(150) }}</p>
                    </div>
                    <div class="btn-group">
                        <a href="{{ url_for('lesson_details', lesson_id=lesson.id) }}"
                           class="btn btn-sm btn-outline-primary">
                            <i class="fas fa-eye me-2"></i>Ø¹Ø±Ø¶ Ø§Ù„ØªÙØ§ØµÙŠÙ„
                        </a>
                        <a href="{{ url_for('lesson_progress_report', lesson_id=lesson.id) }}"
                           class="btn btn-sm btn-outline-info">
                            <i class="fas fa-chart-line me-2"></i>Ø§Ù„ØªÙ‚Ø¯Ù…
                        </a>
                        {% if session.get('role') == 'teacher' %}
                        <a href="{{ url_for('edit_lesson', lesson_id=lesson.id) }}"
                           class="btn btn-sm btn-outline-warning">
                            <i class="fas fa-edit me-2"></i>ØªØ¹Ø¯ÙŠÙ„
                        </a>
                        <form action="{{ url_for('delete_lesson', lesson_id=lesson.id) }}" method="POST"
                              class="d-inline">
                            <button type="submit" class="btn btn-sm btn-outline-danger"
                                    onclick="return confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ø¯Ø±Ø³ØŸ');">
                                <i class="fas fa-trash me-2"></i>Ø­Ø°Ù
                            </button>
                        </form>
                        {% endif %}
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
        {% else %}
        <div class="alert alert-info mt-2">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¯Ø±ÙˆØ³ Ù…ØªØ§Ø­Ø© Ø­Ø§Ù„ÙŠØ§Ù‹</div>
        {% endif %}
    </div>
</div>

        <!-- ØªØ¨ÙˆÙŠØ¨ Ø§Ù„Ù…Ù„ÙØ§Øª -->
<div class="tab-pane fade show active" id="files" role="tabpanel">
            {% if session.get('role') == 'teacher' or (session.get('role') == 'assistant' and permissions.can_upload_files) %}
            <div class="card shadow p-3 mb-3">
                <h4 class="text-success"><i class="fas fa-upload"></i> Ø±ÙØ¹ Ø§Ù„Ù…Ù„ÙØ§Øª ÙˆØ§Ù„Ù…Ø­ØªÙˆÙ‰</h4>
                <form action="{{ url_for('upload_file', subject_id=subject.id) }}" method="POST" enctype="multipart/form-data">
                    <input type="file" name="file" class="form-control" required>
                    <button type="submit" class="btn btn-primary mt-2">Ø±ÙØ¹ Ø§Ù„Ù…Ù„Ù</button>
                </form>
            </div>
            {% endif %}

            <div class="card shadow p-3">
                <h4><i class="fas fa-folder-open"></i> Ø§Ù„Ù…Ù„ÙØ§Øª Ø§Ù„Ù…Ø±ÙÙˆØ¹Ø©</h4>
                {% if files %}
                <div class="list-group">
                    {% for file in files %}
                    <div class="list-group-item">
                        {% if file.file_type == 'video' %}
                        <div class="video-container">
                            <video controls width="100%">
                                <source src="{{ url_for('static', filename='uploads/' + file.filename) }}" type="video/{{ file.extension }}">
                                Ù…ØªØµÙØ­Ùƒ Ù„Ø§ ÙŠØ¯Ø¹Ù… ØªØ´ØºÙŠÙ„ Ø§Ù„ÙÙŠØ¯ÙŠÙˆ.
                            </video>
                        </div>
                        {% else %}
                        <a href="{{ url_for('static', filename='uploads/' + file.filename) }}" target="_blank" class="text-decoration-none">
                            <i class="fas fa-file-alt me-2"></i>{{ file.filename }}
                        </a>
                        {% endif %}
                    </div>
                    {% endfor %}
                </div>
                {% else %}
                <div class="alert alert-info mt-2">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù„ÙØ§Øª Ù…Ø±ÙÙˆØ¹Ø© Ø­ØªÙ‰ Ø§Ù„Ø¢Ù†</div>
                {% endif %}
            </div>
        </div>

        <!-- ØªØ¨ÙˆÙŠØ¨ Ø§Ù„Ø§Ù…ØªØ­Ø§Ù†Ø§Øª -->
<div class="tab-pane fade" id="exams" role="tabpanel">
    <div class="card shadow-lg p-4">
        <h4 class="mb-3 text-primary"><i class="fas fa-tasks"></i> Ø§Ù„Ø§Ù…ØªØ­Ø§Ù†Ø§Øª</h4>

        <!-- âœ… Ø²Ø± Ø¥Ø¶Ø§ÙØ© Ø§Ù…ØªØ­Ø§Ù† Ù„Ù„Ù…Ø¯Ø±Ø³ÙŠÙ† ÙˆØ§Ù„Ù…Ø³Ø§Ø¹Ø¯ÙŠÙ† -->
        {% if session.get('role') == 'teacher' or (session.get('role') == 'assistant' and permissions.can_add_exam) %}
        <a href="{{ url_for('add_exam', subject_id=subject.id) }}" class="btn btn-success mb-3">
            <i class="fas fa-plus-circle"></i> Ø¥Ø¶Ø§ÙØ© Ø§Ù…ØªØ­Ø§Ù† Ø¬Ø¯ÙŠØ¯
        </a>
        <a href="{{ url_for('question_bank', subject_id=subject.id) }}" class="btn btn-primary">
    <i class="fas fa-database"></i> Ø¨Ù†Ùƒ Ø§Ù„Ø£Ø³Ø¦Ù„Ø©
</a>

        {% endif %}

        {% if exams %}
        <div class="list-group">
            {% for exam in exams %}
            <div class="list-group-item border rounded shadow-sm mb-3 p-3">
                <div class="d-flex justify-content-between align-items-center">
                    <div>
                        <!-- âœ… Ø§Ø³Ù… Ø§Ù„Ø§Ù…ØªØ­Ø§Ù† Ù…Ø¹ Ø²Ø± Ø§Ù„Ø¨Ø¯Ø¡ -->
                        <h5 class="text-dark">
                            <a href="{{ url_for('take_exam', exam_id=exam.id) }}" class="text-decoration-none">
                                <i class="fas fa-edit"></i> {{ exam.exam_name }}
                            </a>
                            <a href="{{ url_for('start_exam', exam_id=exam.id) }}" class="btn btn-sm btn-outline-primary ms-2">
                                <i class="fas fa-play"></i> Ø§Ø¨Ø¯Ø£ Ø§Ù„Ø§Ù…ØªØ­Ø§Ù†
                            </a>
                        </h5>

                        <!-- âœ… Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø§Ù…ØªØ­Ø§Ù† Ù…Ø¹ Ø®Ù„ÙÙŠØ© Ù…Ù„ÙˆÙ†Ø© -->
                        <div class="bg-light border rounded p-3 mt-3">
                            <p class="mb-2 text-muted"><i class="fas fa-info-circle"></i> {{ exam.description }}</p>
                            <p class="mb-2"><i class="fas fa-clock text-warning"></i> <strong>Ø§Ù„Ù…Ø¯Ø©:</strong> {{ exam.exam_duration }} Ø¯Ù‚ÙŠÙ‚Ø©</p>
                            <p class="mb-2"><i class="fas fa-redo text-success"></i> <strong>Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø§Øª:</strong> {{ exam.max_attempts }}</p>
                            <p class="mb-2"><i class="fas fa-eye text-primary"></i> <strong>Ø§Ù„Ø­Ø§Ù„Ø©:</strong>
                                {% if exam.is_visible %}
                                    <span class="badge bg-success">Ù…Ø±Ø¦ÙŠ</span>
                                {% else %}
                                    <span class="badge bg-danger">Ù…Ø®ÙÙŠ</span>
                                {% endif %}
                            </p>
                            <p class="mb-2"><i class="fas fa-calendar-alt text-info"></i> <strong>ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¥Ù†Ø´Ø§Ø¡:</strong>
                                {{ exam.created_at.strftime('%Y-%m-%d %H:%M') if exam.created_at else 'ØºÙŠØ± Ù…ØªÙˆÙØ±' }}
                            </p>
                            <p class="mb-2"><i class="fas fa-hourglass-start text-primary"></i> <strong>ÙˆÙ‚Øª Ø§Ù„Ø¨Ø¯Ø¡:</strong>
                                {{ exam.start_time.strftime('%Y-%m-%d %H:%M') if exam.start_time else 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯' }}
                            </p>
                            <p><i class="fas fa-hourglass-end text-danger"></i> <strong>ÙˆÙ‚Øª Ø§Ù„Ø§Ù†ØªÙ‡Ø§Ø¡:</strong>
                                {{ exam.end_time.strftime('%Y-%m-%d %H:%M') if exam.end_time else 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯' }}
                            </p>
                        </div>
                    </div>

                    <!-- âœ… Ø£Ø¯ÙˆØ§Øª Ø§Ù„ØªØ­ÙƒÙ… Ù„Ù„Ù…Ø¯Ø±Ø³ÙŠÙ† ÙˆØ§Ù„Ù…Ø³Ø§Ø¹Ø¯ÙŠÙ† -->
                    {% if session.get('role') == 'teacher' or (session.get('role') == 'assistant' and permissions.can_edit_exams) %}
                    <div class="btn-group">
                        <!-- ğŸ”¹ ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø§Ù…ØªØ­Ø§Ù† -->
                        <a href="{{ url_for('edit_exam', exam_id=exam.id) }}" class="btn btn-sm btn-primary" title="ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø§Ù…ØªØ­Ø§Ù†">
                            <i class="fas fa-edit"></i>
                        </a>

                        <!-- ğŸ”¹ Ø¥Ø®ÙØ§Ø¡/Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ø§Ù…ØªØ­Ø§Ù† -->
                        <form action="{{ url_for('toggle_exam_visibility', exam_id=exam.id) }}" method="POST">
                            <button type="submit" class="btn btn-sm btn-warning" title="Ø¥Ø®ÙØ§Ø¡/Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ø§Ù…ØªØ­Ø§Ù†">
                                {% if exam.is_visible %}
                                <i class="fas fa-eye-slash"></i>
                                {% else %}
                                <i class="fas fa-eye"></i>
                                {% endif %}
                            </button>
                        </form>

                        <!-- ğŸ”¹ Ø­Ø°Ù Ø§Ù„Ø§Ù…ØªØ­Ø§Ù† -->
                        <form action="{{ url_for('delete_exam', exam_id=exam.id) }}" method="POST">
                            <button type="submit" class="btn btn-sm btn-danger" title="Ø­Ø°Ù Ø§Ù„Ø§Ù…ØªØ­Ø§Ù†" onclick="return confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ø§Ù„Ø§Ù…ØªØ­Ø§Ù†ØŸ');">
                                <i class="fas fa-trash"></i>
                            </button>
                        </form>

                        <!-- ğŸ”¹ ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø§Ù…ØªØ­Ø§Ù† -->
                        <a href="{{ url_for('exam_report', exam_id=exam.id) }}" class="btn btn-sm btn-info" title="ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø§Ù…ØªØ­Ø§Ù†">
                            <i class="fas fa-chart-bar"></i> ØªÙ‚Ø±ÙŠØ±
                        </a>
                    </div>
                    {% endif %}
                </div>
            </div>
            {% endfor %}
        </div>
        {% else %}
        <div class="alert alert-info mt-2"><i class="fas fa-exclamation-circle"></i> Ù„Ø§ ØªÙˆØ¬Ø¯ Ø§Ù…ØªØ­Ø§Ù†Ø§Øª Ø­Ø§Ù„ÙŠØ§Ù‹</div>
        {% endif %}
    </div>
</div>

<style>
    .exam-item {
        transition: all 0.3s ease-in-out;
        background-color: #f8f9fa;
        border-left: 5px solid #007bff;
    }
    .exam-item:hover {
        transform: scale(1.02);
        background-color: #e9ecef;
        border-left: 5px solid #0056b3;
    }
    .exam-title:hover {
        color: #007bff !important;
        text-decoration: underline !important;
    }
    .start-btn {
        transition: 0.3s ease-in-out;
    }
    .start-btn:hover {
        background-color: #007bff;
        color: white;
    }
    .exam-info {
        background: #f1f1f1;
        border-left: 4px solid #28a745;
    }
    .exam-controls button, .exam-controls a {
        margin: 0 2px;
    }
</style>

        <!-- ØªØ¨ÙˆÙŠØ¨ Ø§Ù„ÙˆØ§Ø¬Ø¨Ø§Øª -->
<div class="tab-pane fade" id="homeworks" role="tabpanel">
    <div class="card shadow p-3">
        <h4><i class="fas fa-tasks"></i> Ø§Ù„ÙˆØ§Ø¬Ø¨Ø§Øª</h4>
        {% if session.get('role') == 'teacher' or (session.get('role') == 'assistant' and permissions.can_add_homework) %}
        <a href="{{ url_for('add_homework', subject_id=subject.id) }}" class="btn btn-info mb-3">
            <i class="fas fa-plus-circle"></i> Ø¥Ø¶Ø§ÙØ© ÙˆØ§Ø¬Ø¨
        </a>

        {% endif %}

        {% if homeworks %}
        <div class="list-group">
            {% for hw in homeworks %}
            <div class="list-group-item">
                <div class="d-flex justify-content-between align-items-start">
                    <div class="w-75">
                        <h5>{{ hw.title }}</h5>
                        <p class="text-muted">{{ hw.description }}</p>

                        <!-- âœ… ØªØ­Ø¯ÙŠØ« Ø·Ø±ÙŠÙ‚Ø© Ø¹Ø±Ø¶ ØªØ§Ø±ÙŠØ® Ø§Ù„ØªØ³Ù„ÙŠÙ… -->
                        <div class="text-muted small">
                            <i class="fas fa-clock"></i>
                            Ù…ÙˆØ¹Ø¯ Ø§Ù†ØªÙ‡Ø§Ø¡ Ø§Ù„ØªØ³Ù„ÙŠÙ…: {{ hw.due_date_str }}
                        </div>
                        {% if session.role == 'student' %}

                        <!-- âœ… Ø¹Ø±Ø¶ Ø­Ø§Ù„Ø© Ø§Ù„ØªØ³Ù„ÙŠÙ… ÙˆØ§Ù„ØªÙØ§ØµÙŠÙ„ -->
                        <div class="mt-2">
                            <strong>{{ hw.status }}</strong>
                            <p class="text-muted small">{{ hw.details|safe }}</p>
                        </div>
                            {% endif %}

                        {% if session.role == 'student' %}
                        <div class="mt-2">
                            {% if hw.status == "Ù„Ù… ÙŠØªÙ… Ø§Ù„ØªØ³Ù„ÙŠÙ…" and "Ø§Ù†ØªÙ‡Øª Ø§Ù„Ù…Ù‡Ù„Ø©" not in hw.details %}
                            <form action="{{ url_for('submit_homework', subject_id=subject.id, homework_id=hw.id) }}" method="POST" enctype="multipart/form-data">
                                <div class="input-group">
                                    <input type="file" class="form-control" name="file" required>
                                    <button type="submit" class="btn btn-success">
                                        <i class="fas fa-upload"></i> ØªØ³Ù„ÙŠÙ…
                                    </button>
                                </div>
                            </form>
                            {% else %}
                            <div class="alert alert-danger py-2 mb-0">
                                <i class="fas fa-lock"></i> Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„ØªØ³Ù„ÙŠÙ… Ø§Ù„Ø¢Ù†
                            </div>
                            {% endif %}
                        </div>
                        {% endif %}
                    </div>
{% if session.get('role') == 'student' %}
                    <div class="btn-group">
                        <a href="{{ url_for('homework_submissions', homework_id=hw.id) }}"
                           class="btn btn-sm btn-info">
                            <i class="fas fa-list"></i> Ø§Ù„ØªØ³Ù„ÙŠÙ…Ø§Øª
                        </a>
{% endif %}
                    {% if session.get('role') == 'teacher' or (session.get('role') == 'assistant' and permissions.can_view_submissions) %}
                    <div class="btn-group">
                        <a href="{{ url_for('homework_submissions', homework_id=hw.id) }}"
                           class="btn btn-sm btn-info">
                            <i class="fas fa-list"></i> Ø§Ù„ØªØ³Ù„ÙŠÙ…Ø§Øª
                        </a>

                        <form action="{{ url_for('delete_homework', homework_id=hw.id) }}" method="POST">
                            <button type="submit" class="btn btn-sm btn-danger">
                                <i class="fas fa-trash"></i>
                            </button>
                        </form>
                    </div>
                    {% endif %}

                </div>
            </div>
            {% endfor %}

  {% if session.get('role') == 'teacher' or (session.get('role') == 'assistant' and permissions.can_add_homework) %}
        <a href="{{ url_for('subject_homeworks', subject_id=subject.id) }}" class="btn btn-info mb-3">
            <i class="fas fa-subject_homeworks"></i>Ø§Ù†Ø´Ø§Ø¡ ØªÙ‚Ø±ÙŠØ± ğŸ“„
        </a>

        {% endif %}



        </div>
        {% else %}
        <div class="alert alert-info mt-2">Ù„Ø§ ØªÙˆØ¬Ø¯ ÙˆØ§Ø¬Ø¨Ø§Øª Ø­Ø§Ù„ÙŠØ§Ù‹</div>
        {% endif %}
    </div>
</div>


              <!-- ØªØ¨ÙˆÙŠØ¨ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø§Ø¯Ø© -->
 <div class="tab-pane fade show active" id="manage" role="tabpanel">
        <div class="card shadow-lg p-3">
            <h4 class="text-center text-primary mb-4">
                <i class="fas fa-cogs"></i> Ø£Ø¯ÙˆØ§Øª Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©
            </h4>

            <div class="row row-cols-1 row-cols-md-2 row-cols-lg-3 g-3">

                {% if session.get('role') == 'teacher' %}
                <div class="col">
                    <div class="card text-white bg-success shadow-sm">
                        <div class="card-body text-center">
                            <i class="fas fa-key fa-2x mb-2"></i>
                            <h5 class="card-title">ØªÙˆÙ„ÙŠØ¯ Ø£ÙƒÙˆØ§Ø¯ Ø§Ù„ØªØ³Ø¬ÙŠÙ„</h5>
                            <form action="{{ url_for('generate_subject_codes', subject_id=subject.id) }}" method="POST">
                                <button type="submit" class="btn btn-light w-100">ğŸ”‘ ØªÙˆÙ„ÙŠØ¯ Ø§Ù„Ø£ÙƒÙˆØ§Ø¯</button>
                            </form>
                        </div>
                    </div>
                </div>
                {% endif %}

                {% if session.get('role') == 'teacher' %}
                <div class="col">
                    <div class="card text-dark bg-warning shadow-sm">
                        <div class="card-body text-center">
                            <i class="fas fa-edit fa-2x mb-2"></i>
                            <h5 class="card-title">ØªØ¹Ø¯ÙŠÙ„ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…Ø§Ø¯Ø©</h5>
                            <a href="{{ url_for('edit_subject', subject_id=subject.id) }}" class="btn btn-dark w-100">âœ ØªØ¹Ø¯ÙŠÙ„</a>
                        </div>
                    </div>
                </div>
                {% endif %}

                {% if session.get('role') == 'teacher' or (session.get('role') == 'assistant' and permissions.can_manage_students) %}
                <div class="col">
                    <div class="card text-white bg-info shadow-sm">
                        <div class="card-body text-center">
                            <i class="fas fa-users fa-2x mb-2"></i>
                            <h5 class="card-title">Ø§Ù„Ø·Ù„Ø§Ø¨ Ø§Ù„Ù…Ø³Ø¬Ù„ÙŠÙ†</h5>
                            <a href="{{ url_for('registered_students', subject_id=subject.id) }}" class="btn btn-light w-100">ğŸ‘¥ Ø¹Ø±Ø¶ Ø§Ù„Ø·Ù„Ø§Ø¨</a>
                        </div>
                    </div>
                </div>
                {% endif %}

                {% if session.get('role') == 'teacher' %}
                <div class="col">
                    <div class="card text-white bg-primary shadow-sm">
                        <div class="card-body text-center">
                            <i class="fas fa-tags fa-2x mb-2"></i>
                            <h5 class="card-title">Ø§Ù„Ø£ÙƒÙˆØ§Ø¯ Ø§Ù„Ù…ØªØ§Ø­Ø©</h5>
                            <a href="{{ url_for('available_codes', subject_id=subject.id) }}" class="btn btn-light w-100">ğŸ“œ Ø¹Ø±Ø¶ Ø§Ù„Ø£ÙƒÙˆØ§Ø¯</a>
                        </div>
                    </div>
                </div>
                {% endif %}

                {% if session.get('role') == 'teacher' or (session.get('role') == 'assistant' and permissions.can_view_progress) %}
                <div class="col">
                    <div class="card text-white bg-dark shadow-sm">
                        <div class="card-body text-center">
                            <i class="fas fa-chart-line fa-2x mb-2"></i>
                            <h5 class="card-title">ØªÙ‚Ø±ÙŠØ± ØªÙ‚Ø¯Ù… Ø§Ù„Ø·Ù„Ø§Ø¨</h5>
                            <a href="{{ url_for('generate_report', subject_id=subject.id) }}" class="btn btn-light w-100">ğŸ“Š Ø¹Ø±Ø¶ Ø§Ù„ØªÙ‚Ø±ÙŠØ±</a>
                        </div>
                    </div>
                </div>
                {% endif %}

                {% if session.get('role') == 'teacher' %}
                <div class="col">
                    <div class="card text-white bg-secondary shadow-sm">
                        <div class="card-body text-center">
                            <i class="fas fa-question-circle fa-2x mb-2"></i>
                            <h5 class="card-title">Ø¥Ø¶Ø§ÙØ© Ø£Ø³Ø¦Ù„Ø© Ø§Ù„ØªÙ‚ÙŠÙŠÙ…</h5>
                            <a href="{{ url_for('add_evaluation_question', subject_id=subject.id) }}" class="btn btn-light w-100">â• Ø¥Ø¶Ø§ÙØ© Ø³Ø¤Ø§Ù„</a>
                        </div>
                    </div>
                </div>
                {% endif %}

                {% if session.get('role') == 'teacher' %}
                <div class="col">
                    <div class="card text-white bg-danger shadow-sm">
                        <div class="card-body text-center">
                            <i class="fas fa-toggle-on fa-2x mb-2"></i>
                            <h5 class="card-title">ØªÙØ¹ÙŠÙ„/ØªØ¹Ø·ÙŠÙ„ Ø§Ù„ØªÙ‚ÙŠÙŠÙ…</h5>
                            <form action="{{ url_for('toggle_evaluation', subject_id=subject.id) }}" method="post">
                                {% if subject.evaluation_status %}
                                    <button type="submit" class="btn btn-light w-100">ğŸ”´ ØªØ¹Ø·ÙŠÙ„ Ø§Ù„ØªÙ‚ÙŠÙŠÙ…</button>
                                {% else %}
                                    <button type="submit" class="btn btn-light w-100">ğŸŸ¢ ØªÙØ¹ÙŠÙ„ Ø§Ù„ØªÙ‚ÙŠÙŠÙ…</button>
                                {% endif %}
                            </form>
                        </div>
                    </div>
                </div>
                {% endif %}

                {% if session.get('role') in ['teacher', 'admin'] %}
                <div class="col">
                    <div class="card text-white bg-info shadow-sm">
                        <div class="card-body text-center">
                            <i class="fas fa-poll fa-2x mb-2"></i>
                            <h5 class="card-title">Ø¹Ø±Ø¶ Ø§Ù„ØªÙ‚ÙŠÙŠÙ…Ø§Øª</h5>
                            <a href="{{ url_for('view_evaluations', subject_id=subject.id) }}" class="btn btn-light w-100">ğŸ“Š Ø¹Ø±Ø¶ Ø§Ù„ØªÙ‚ÙŠÙŠÙ…Ø§Øª</a>
                        </div>
                    </div>
                </div>
                {% endif %}

                {% if session['role'] == 'teacher' %}
                <div class="col">
                    <div class="card text-white bg-primary shadow-sm">
                        <div class="card-body text-center">
                            <i class="fas fa-user-cog fa-2x mb-2"></i>
                            <h5 class="card-title"> Ø§Ù„Ù‡ÙŠØ¦Ø© Ø§Ù„Ù…Ø¹Ø§ÙˆÙ†Ø©</h5>
                            <a href="{{ url_for('manage_assistants', subject_id=subject.id) }}" class="btn btn-light w-100">âš™ Ø¥Ø¯Ø§Ø±Ø©</a>
                        </div>
                    </div>
                </div>
                {% endif %}

                {% if session.get('role') == 'teacher' %}
                <div class="col">
                    <div class="card text-white bg-danger shadow-sm">
                        <div class="card-body text-center">
                            <i class="fas fa-trash-alt fa-2x mb-2"></i>
                            <h5 class="card-title">Ø­Ø°Ù Ø§Ù„Ù…Ø§Ø¯Ø© Ø¨Ø§Ù„ÙƒØ§Ù…Ù„</h5>
                            <form action="{{ url_for('delete_subject', subject_id=subject.id) }}" method="POST" onsubmit="return confirm('âš ï¸ Ø³ÙŠØªÙ… Ø­Ø°Ù Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø±ØªØ¨Ø·Ø© Ø¨Ø§Ù„Ù…Ø§Ø¯Ø©! Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ØŸ')">
                                <button type="submit" class="btn btn-light w-100">ğŸ—‘ Ø­Ø°Ù Ø§Ù„Ù…Ø§Ø¯Ø©</button>
                            </form>
                        </div>
                    </div>
                </div>
                {% endif %}

            </div>
        </div>
    </div>



<!-- Ø³ÙƒØ±ÙŠØ¨Øª Ø¬Ù„Ø¨ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ ÙˆØ¥Ø±Ø³Ø§Ù„Ù‡Ø§ -->
<script>
    function loadChatMessages() {
        fetch("{{ url_for('get_chat_messages', subject_id=subject.id) }}")
            .then(response => response.json())
            .then(data => {
                let chatBox = document.getElementById("chat-messages");
                chatBox.innerHTML = "";
                data.forEach(msg => {
                    let messageElement = document.createElement("p");
                    messageElement.innerHTML = `<strong>${msg.username}:</strong> ${msg.message}`;
                    chatBox.appendChild(messageElement);
                });
            });
    }

    document.getElementById("chat-form").addEventListener("submit", function(event) {
        event.preventDefault();
        let formData = new FormData(this);
        fetch("{{ url_for('send_chat_message', subject_id=subject.id) }}", {
            method: "POST",
            body: formData
        }).then(response => response.json())
          .then(data => {
              if (data.status === "success") {
                  loadChatMessages();
                  this.reset();
              }
          });
    });

    setInterval(loadChatMessages, 5000);
</script>
</div>

</div>
    </div>

    <div class="text-center mt-4">
        <a href="{{ url_for('subjects') }}" class="btn btn-secondary">
            <i class="fas fa-arrow-left"></i> Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…ÙˆØ§Ø¯
        </a>
    </div>
</div>

{% endblock %}